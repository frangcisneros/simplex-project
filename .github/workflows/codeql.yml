# Para la mayoría de los proyectos, este archivo de flujo de trabajo no necesita cambios significativos.
# Simplemente se debe confirmar en el repositorio.
#
# Este archivo puede ser modificado para ajustar los lenguajes analizados,
# o para proporcionar consultas o lógica de construcción personalizada.
#
# ******** NOTA ********
# Se han detectado los lenguajes en el repositorio. Verifique la matriz `language`
# definida a continuación para confirmar que tiene el conjunto correcto de lenguajes soportados por CodeQL.

name: "CodeQL Advanced"

on:
  # Define los eventos que activan este flujo de trabajo.
  push:
    branches: ["develop"] # Se ejecuta cuando hay un push a la rama "develop".
  pull_request:
    branches: ["develop"] # También se ejecuta en pull requests hacia la rama "develop".
  schedule:
    - cron: "43 8 * * 2" # Programa la ejecución automática cada martes a las 8:43 AM UTC.

jobs:
  analyze:
    name: Analyze (${{ matrix.language }}) # Nombre del trabajo, incluye el lenguaje analizado.
    # El tamaño del runner afecta el tiempo de análisis de CodeQL.
    # Se recomienda usar runners más grandes o máquinas con mayores recursos para mejorar los tiempos de análisis.
    runs-on: ${{ (matrix.language == 'swift' && 'macos-latest') || 'ubuntu-latest' }} # Usa macOS para Swift, Ubuntu para otros lenguajes.
    permissions:
      # Permisos necesarios para que el flujo de trabajo funcione correctamente.
      security-events: write # Requerido para registrar eventos de seguridad.
      packages: read # Permite leer paquetes internos o privados de CodeQL.
      actions: read # Necesario para repositorios privados.
      contents: read # Permite leer el contenido del repositorio.

    strategy:
      fail-fast: false # Permite que otros trabajos continúen incluso si uno falla.
      matrix:
        include:
          - language: python # Define Python como el lenguaje a analizar.
            build-mode: none # No se requiere un modo de construcción para Python.
        # CodeQL soporta otros lenguajes como C/C++, Java, JavaScript, etc.
        # Para más información sobre cómo personalizar los lenguajes analizados, consulte la documentación oficial.

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4 # Clona el repositorio en el entorno de ejecución.

      # Agregue pasos de configuración antes de inicializar CodeQL si es necesario.
      # Por ejemplo, instalar compiladores o entornos de ejecución.
      # - name: Setup runtime (example)
      #   uses: actions/setup-example@v1

      # Inicializa las herramientas de CodeQL para el análisis.
      - name: Initialize CodeQL
        uses: github/codeql-action/init@v4
        with:
          languages: ${{ matrix.language }} # Especifica el lenguaje a analizar.
          build-mode: ${{ matrix.build-mode }} # Define el modo de construcción (si aplica).
          # Se pueden especificar consultas personalizadas aquí o en un archivo de configuración.
          # Las consultas listadas aquí sobrescriben las definidas en el archivo de configuración.
          # Para más detalles sobre los paquetes de consultas de CodeQL, consulte la documentación oficial.

      # Si el paso de análisis falla con "No se pudo construir automáticamente su código",
      # modifique la matriz para establecer el modo de construcción en "manual" y ajuste este paso.
      - name: Run manual build steps
        if: matrix.build-mode == 'manual' # Solo se ejecuta si el modo de construcción es manual.
        shell: bash
        run: |
          echo 'Si está utilizando un modo de construcción "manual", reemplace esto con los comandos para construir su código.'
          echo 'Por ejemplo:'
          echo '  make bootstrap'
          echo '  make release'
          exit 1  # Este paso fallará intencionalmente hasta que se reemplace con comandos reales.

      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v4 # Ejecuta el análisis de CodeQL.
        with:
          category: "/language:${{matrix.language}}" # Categoriza los resultados por lenguaje.
